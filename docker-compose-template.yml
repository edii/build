version: '2'
services:
  web:
    build:
      context: ./docker/vendor/docker/src/
      dockerfile: Dockerfile.yml
      args:
        - php=56 # (54|55|56|70)
        - UID={{ UID_VALUE }}
        - GID={{ GID_VALUE }}
        - NODE=4.4.3 # (0.10.44|0.12.13|0.12|0.10|4.4.3|4.4|4|5.10.1|5.10|5|latest)
    restart: always
    privileged: false
    stdin_open: true
    tty: true
    container_name: lyrebird_web
    ports:
      - "127.0.0.20:80:80"
      - "127.0.0.20:443:443"
      - "127.0.0.20:9000:9000"
      - "2224:22"
      - "127.0.0.20:3306:13306"
    links:
      - lyrebird_db:mysql
    volumes:
      # system
      - ./:/var/www:rw
#      - ./postgres:/var/www/postgres:ro
      - ./tmp:/var/www/tmp:rw
      - ./docker/conf/php.ini:/etc/php.ini:rw
      - ./docker/conf/custom.sh:/scripts/custom.sh:rw
      - ./docker/conf/docker.conf:/etc/nginx/conf.d/docker.conf:rw
      - ./docker/conf/.ssh:/root/.ssh:rw
      # symfony
      - ./vendor:/var/www/vendor:rw
    extra_hosts:
      - "rest.dev:127.0.0.20"
      - "int.office.local:192.168.11.183"
      - "stash.office.dev:192.168.223.32"
    depends_on:
      - lyrebird_db
    dns:
      - 8.8.8.8
      - 192.168.70.217
    environment:
      - COMPOSE_PROJECT_NAME=rest
      - DEBUG=true
      - RACK_ENV=development
      - SHOW=true
      - SESSION_SECRET

#  # phpmyadmin
#  phppgadmin:
#    image: maxexcloo/phppgadmin
#    container_name: rest_phppgadmin
#    links:
#      - postgres:postgresql
#    ports:
#      - "8083:80"
#    expose:
#      - "8083"
#
#  # postgres
#  postgres:
#    restart: always
#    image: postgres:latest
#    container_name: rest_postgres
#    volumes:
#      - ./postgres/pdata:/pdata
#      - ./postgres/log:/var/log/postgresql
#    environment:
#      LC_ALL: C.UTF-8
#      POSTGRES_USER: docker-data
#      POSTGRES_PASSWORD: root
#      PGDATA: "/pdata"

  # phpmyadmin
  resy_myadmin:
    image: phpmyadmin/phpmyadmin
    container_name: lyrebird_myadmin
    restart: always
    links:
      - lyrebird_db:mysql
    ports:
      - "8084:80"
      - "3308:13306"
    expose:
      - "8084"
#    depends_on:
#      - lyrebird_db
    environment:
      - PMA_ARBITRARY=1
#      - PMA_PORT=3307
#      - PMA_HOST=mysql

  # mysqls
  lyrebird_db:
    image: mysql:latest
    container_name: lyrebird_mysql
    ports:
      - "13306:3306"
    expose:
      - "13306"
    volumes:
      - ./mysql/data:/var/lib/mysql:rw
      - ./mysql/log/mysql.log:/var/log/mysqld.log
    environment:
      MYSQL_ROOT_PASSWORD: root
